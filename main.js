const feedElement=document.getElementById("feed"),loadingIndicator=document.getElementById("loadingIndicator"),mockData=[{id:1,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image12-optimized.jpg"},date:"Today",author:"Author"},{id:2,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image2-optimized.jpg"},date:"Today",author:"Author"},{id:3,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image3-optimized.jpg"},date:"Today",author:"Author"},{id:4,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image4-optimized.jpg"},date:"Today",author:"Author"},{id:5,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image5-optimized.jpg"},date:"Today",author:"Author"},{id:6,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image6-optimized.jpg"},date:"Today",author:"Author"},{id:7,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image7-optimized.jpg"},date:"Today",author:"Author"},{id:8,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image8-optimized.jpg"},date:"Today",author:"Author"},{id:9,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image9-optimized.jpg"},date:"Today",author:"Author"},{id:10,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image10-optimized.jpg"},date:"Today",author:"Author"},{id:11,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image11-optimized.jpg"},date:"Today",author:"Author"},{id:12,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image1-optimized.jpg"},date:"Today",author:"Author"},{id:13,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image13-optimized.jpg"},date:"Today",author:"Author"},{id:14,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image14-optimized.jpg"},date:"Today",author:"Author"},{id:15,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image15-optimized.jpg"},date:"Today",author:"Author"},{id:16,title:"Lorem ipsum",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",media:{type:"image",url:"images/image16-optimized.jpg"},date:"Today",author:"Author"}];let currentPage=0;const itemsPerPage=5;let isLoading=!1,observer;function createFeedItem(e){const i=document.createElement("div");i.className="feed-item",i.setAttribute("data-id",e.id);let t="";return"image"===e.media.type&&(t='<div class="feed-item-media"><img data-src="'+e.media.url+'" alt="'+e.title+'" class="lazy"><div class="placeholder">Изображение загружается...</div></div>'),i.innerHTML='<div class="feed-item-header"><h2 class="feed-item-title">'+e.title+'</h2><div class="feed-item-meta"><span class="feed-item-author">Автор: '+e.author+'</span><span class="feed-item-date">'+e.date+'</span></div></div><div class="feed-item-content"><p class="feed-item-description">'+e.description+"</p>"+t+"</div>",i}function loadData(a){return new Promise((t,o)=>{setTimeout(()=>{var e=a*itemsPerPage,i=e+itemsPerPage,i=mockData.slice(e,i);0<i.length?t(i):o(new Error("Больше данных нет"))},1e3)})}function renderItems(e){e.forEach(e=>{e=createFeedItem(e);feedElement.appendChild(e)}),initLazyLoading()}function initLazyLoading(){observer&&observer.disconnect();const e=document.querySelectorAll(".lazy");observer=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const i=e.target;"IMG"===i.tagName&&(i.src=i.getAttribute("data-src")),i.src=i.getAttribute("data-src"),i.classList.remove("lazy"),i.onload=()=>{const e=i.parentNode.querySelector(".placeholder");e&&(e.style.display="none")},i.onerror=()=>{const e=i.parentNode.querySelector(".placeholder");e&&(e.textContent="Ошибка загрузки медиа",e.style.color="#e74c3c")},observer.unobserve(i)}})}),e.forEach(e=>{observer.observe(e)})}async function loadNextPage(){if(!isLoading){isLoading=!0,loadingIndicator.style.display="block";try{renderItems(await loadData(currentPage)),currentPage++}catch(e){console.error("Ошибка загрузки данных:",e),showError("Не удалось загрузить данные")}finally{isLoading=!1,loadingIndicator.style.display="none"}}}function showError(e){const i=document.createElement("div");i.className="error-message",i.textContent=e,feedElement.appendChild(i)}function handleInfiniteScroll(){var e=window.scrollY,i=window.innerHeight;document.documentElement.scrollHeight-500<=e+i&&!isLoading&&loadNextPage()}document.addEventListener("DOMContentLoaded",()=>{loadNextPage(),window.addEventListener("scroll",handleInfiniteScroll)});